
<body id="show-page">
  <div class='jumbotron'>
    <div class='row'>
      <div class='col-md-12 term-header'>
        <h2 class = "term-title">What is <%= term.term %>?</h2>
        <p class="short-def"><%= term.summary %></p>
        <a type="button" data-toggle="modal" data-target="#addDef" class="add-definition-link">Add an explanation</a>
      </div>
    </div>
  </div>
  <div class='container'>
    <div class='row'>
      <% term.definitions.forEach(function(definition) { %>
      <div class='col-md-6'>

        <div class='definitions'>
          <p class="long-def"><%= definition.definition %></p>
          <div class="vote-source">
            <div class="vote">
              <form class="vote">
                <input type="hidden" class="form-control" value="<%= term.term %>" name="term" readonly>
                <input type="hidden" class="form-control form-def" value="<%= definition.definition %>" name="definition" readonly>
                <button type="submit" name="upvote"  class=" btn upvote"><i class="fa fa-chevron-up"></i></button>
                <p class="rating"><%= definition.rating %></p>
                <button type="submit" name="downvote"  class="btn downvote"><i class="fa fa-chevron-down"></i></button>
              </form>
            </div>
            <a class="source" href="<%= definition.source %>">Source</a>
          </div>
        </div>
      </div>
        <% }) %>
    </div>
  </div>

  <div id="addDef" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h3 class="modal-title">Add a Definition </h3>
        </div>
        <div class="modal-body">
          <form method="post" action="/newdefinition">
            <div class="form-group">
              <input type="hidden" class="form-control" value="<%= term.term %>" name="term" readonly>
            </div>
            <div class="form-group">
              <label for="definition">Definition</label>
              <textarea class="form-control" id="definition" name="definition" rows="15"></textarea>
            </div>
            <div class="form-group">
              <label for="source">Source</label>
              <input type="url" class="form-control" id="source" name="source">
            </div>
              <button type="submit" class="btn btn-default btn-addterm">Add</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    window.sr = ScrollReveal();
    sr.reveal('.definitions');
    $(".upvote").on('click', function(event){

      event.preventDefault();

      var rating = $(this).siblings('.rating');
      var term = $(this).siblings($("input[name='term']")).val()
      var definition = $(this).siblings(".form-def").val()
      data = {"term": term, "definition":definition}
      $.ajax({
        url: "/show/upvote",
        method: "POST",
        data: data,
      }).done(function(response) {
        for (var i = 0; i < response.definitions.length; i++) {
          if (response.definitions[i].definition === definition) {
            rating.text(response.definitions[i].rating)
          }
        }
     }).fail(function() {
       alert( "failure" );
     }).always(function() {
       console.log( "complete" );
     });
  });

  $(".downvote").on('click', function(event){

    event.preventDefault();

    var rating = $(this).siblings('.rating');
    var term = $(this).siblings($("input[name='term']")).val()
    var definition = $(this).siblings(".form-def").val()
    data = {"term": term, "definition":definition}
    $.ajax({
      url: "/show/downvote",
      method: "POST",
      data: data,
    }).done(function(response) {
      for (var i = 0; i < response.definitions.length; i++) {
        if (response.definitions[i].definition === definition) {
          rating.text(response.definitions[i].rating)
        }
      }
   }).fail(function() {
     alert( "failure" );
   }).always(function() {
   });
});
  </script>
</body>
